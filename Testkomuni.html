<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SÁZKOVKA TEST v2.0</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="IMG_8429.png">

    <style>
        body { font-family: -apple-system, sans-serif; background: #000; color: #fff; text-align: center; padding: 20px; }
        .card { background: #111; border: 2px solid #00f2ff; border-radius: 20px; padding: 20px; margin-bottom: 20px; }
        button { width: 100%; padding: 20px; border-radius: 15px; border: none; font-weight: 900; cursor: pointer; margin: 10px 0; }
        #testBtn { background: #00f2ff; color: #000; }
        #btnSend { background: #ff00ff; color: #fff; display: none; }
        .debug-box { text-align: left; background: #222; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 11px; color: #00ff00; overflow-y: auto; height: 150px; }
    </style>
</head>
<body>

    <div class="card">
        <h2 style="color:#00f2ff">TEST ODBĚRU</h2>
        <div id="statusText" style="font-weight:bold; margin-bottom:10px;">Načítám...</div>
        <button id="testBtn">POVOLIT NOTIFIKACE</button>
    </div>

    <div id="sendCard" class="card" style="display:none;">
        <h2 style="color:#ff00ff">TEST ODESLÁNÍ</h2>
        <button id="btnSend">POSLAT TEST TEĎ</button>
    </div>

    <div class="debug-box" id="log">
        [LOG]: Systém připraven...<br>
    </div>

    <script>
        const logBox = document.getElementById('log');
        function writeLog(m) { logBox.innerHTML += "> " + m + "<br>"; logBox.scrollTop = logBox.scrollHeight; }

        // --- WEBPUSHR SDK ---
        (function(w,d, s, id) {
            if(typeof(w.webpushr)!=='undefined') return;
            w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};
            var js, fjs = d.getElementsByTagName(s)[0];
            js = d.createElement(s); js.id = id;js.async=1;
            js.src = "https://cdn.webpushr.com/app.min.js";
            fjs.parentNode.appendChild(js);
        }(window,document, 'script', 'webpushr-jssdk-alternative'));

        // TVŮJ NOVÝ PUBLIC KEY (BJLql...)
        webpushr('init','BJLqlsfhPhmUGRT1vU8Ob_iUP0ZGtgh2-jGjhFTc8u_rCYpSIBMjasZ1HPA0EJSUDjRfpB59-lv7i1B3zObvF5w','webpushr-sw.js','/SazkovkaNadeje/');

        function update() {
            if(typeof webpushr !== 'undefined') {
                webpushr('notification_status', function(s) {
                    document.getElementById('statusText').innerText = "STAV: " + s.toUpperCase();
                    if(s === 'granted') document.getElementById('sendCard').style.display = 'block';
                });
            } else { setTimeout(update, 1000); }
        }
        update();

        const btn = document.getElementById('testBtn');
        const action = (e) => {
            if(e) e.preventDefault();
            writeLog("Žádám o odběr...");
            webpushr('fetch_subscription', function(r) {
                writeLog("Výsledek: " + r.status);
                if(r.status === 'success') {
                    alert("ÚSPĚCH! ✅");
                    location.reload();
                } else {
                    alert("CHYBA: " + r.description);
                }
            });
        };

        btn.addEventListener('click', action);
        btn.addEventListener('touchend', action);

        // TEST ODESLÁNÍ
        document.getElementById('btnSend').onclick = async function() {
            writeLog("Odesílám Push přes REST API...");
            try {
                const response = await fetch('https://api.webpushr.com/v1/notification/send/all', {
                    method: 'POST',
                    headers: {
                        'webpushrKey': 'cc80b06b1a513c4ac1227033bda09e2a',
                        'webpushrAuthToken': '119013',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "title": "SÁZKOVKA: TEST ✅",
                        "message": "Notifikace fungují!",
                        "target_url": "https://sazkynadeje.github.io/SazkovkaNadeje/"
                    })
                });
                const res = await response.json();
                writeLog("API odpověď: " + res.status);
                if(res.status === 'success') alert("Odesláno!");
            } catch (e) { writeLog("Chyba: " + e); }
        };
    </script>
</body>
</html>
