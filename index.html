<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVÁ SÁZKOVKA TEST</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 30px; background: #0f172a; color: white; }
        .card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 25px; border: 1px solid #00f2ff; margin-bottom: 20px; }
        button { width: 100%; padding: 20px; margin: 10px 0; border-radius: 15px; border: none; font-weight: bold; font-size: 1em; cursor: pointer; }
        #btnReg { background: #00f2ff; color: #000; }
        #btnSend { background: #ff00ff; color: #fff; display: none; }
        .status { font-size: 0.9em; opacity: 0.7; margin-top: 10px; word-break: break-all; }
    </style>
</head>
<body>

    <div class="card">
        <h2>1. KROK: PŘIHLÁŠENÍ</h2>
        <button id="btnReg">AKTIVOVAT ODBĚR</button>
        <div class="status" id="statReg">Čekám...</div>
    </div>

    <div class="card" id="sendCard" style="display:none;">
        <h2>2. KROK: TEST ODESLÁNÍ</h2>
        <p>Teď zkusíme, jestli ty nové API klíče fungují.</p>
        <button id="btnSend">POSLAT TEST SOBĚ I OSTATNÍM</button>
        <div class="status" id="statSend"></div>
    </div>

    <script>
    // --- SDK INICIALIZACE ---
    (function(w,d, s, id) {
        if(typeof(w.webpushr)!=='undefined') return;
        w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};
        var js, fjs = d.getElementsByTagName(s)[0];
        js = d.createElement(s); js.id = id;js.async=1;
        js.src = "https://cdn.webpushr.com/app.min.js";
        fjs.parentNode.appendChild(js);
    }(window,document, 'script', 'webpushr-jssdk-alternative'));

    // TVŮJ NOVÝ PUBLIC KEY
    webpushr('init','BJLqlsfhPhmUGRT1vU8Ob_iUP0ZGtgh2-jGjhFTc8u_rCYpSIBMjasZ1HPA0EJSUDjRfpB59-lv7i1B3zObvF5w','webpushr-sw.js','/SazkovkaNadeje/');

    webpushr('setup', { 'in_app_notification': false, 'onsite_messaging': false });

    window.onload = function() {
        setTimeout(function() {
            if(typeof webpushr !== 'undefined') {
                webpushr('notification_status', function(status) {
                    document.getElementById('statReg').innerText = "Stav: " + status;
                    if(status === 'granted') document.getElementById('sendCard').style.display = 'block';
                });
            }
        }, 3000);
    };

    // --- REGISTRACE ODBĚRU ---
    document.getElementById('btnReg').onclick = function() {
        webpushr('fetch_subscription', function(result) {
            if(result.status === 'success') {
                document.getElementById('statReg').innerHTML = "<b style='color:lime'>ÚSPĚCH! ✅</b>";
                document.getElementById('sendCard').style.display = 'block';
                document.getElementById('btnSend').style.display = 'block';
            } else {
                document.getElementById('statReg').innerHTML = "<b style='color:red'>CHYBA:</b> " + result.description;
            }
        });
    };

    // --- ODESLÁNÍ TESTU PŘES TVOJE NOVÁ REST API ---
    document.getElementById('btnSend').onclick = async function() {
        const stat = document.getElementById('statSend');
        stat.innerText = "Odesílám přes API...";

        const body = {
            "title": "TEST FUNGUJE! ⚽",
            "message": "Pokud to vidíš, nové klíče jsou správně.",
            "target_url": "https://sazkynadeje.github.io/SazkovkaNadeje/",
            "urgency": "high"
        };

        try {
            const response = await fetch('https://api.webpushr.com/v1/notification/send/all', {
                method: 'POST',
                headers: {
                    'webpushrKey': 'cc80b06b1a513c4ac1227033bda09e2a',
                    'webpushrAuthToken': '119013',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });
            const data = await response.json();
            stat.innerText = "Výsledek: " + data.status;
            if(data.status === 'success') alert("Odesláno! Teď čekej, jestli to pípne.");
        } catch (e) {
            stat.innerText = "Chyba API: " + e;
        }
    };
    </script>
</body>
</html>
