<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KANCEL√Å≈ò NADƒöJE v2.0</title>

    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="IMG_8429.png">

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --neon: #00f2ff;
            --dark: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background-color: var(--dark);
            color: #ffffff;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 15px;
            text-align: center;
            min-height: 100vh;
        }

        /* TV≈ÆJ DESIGN */
        .header-logo {
            max-width: 450px; width: 90%;
            margin: 20px 0;
            filter: drop-shadow(0 0 10px var(--neon));
            animation: neonGlow 4s ease-in-out infinite alternate;
        }
        @keyframes neonGlow {
            0% { filter: drop-shadow(0 0 5px var(--neon)); transform: scale(1); }
            100% { filter: drop-shadow(0 0 20px var(--neon)); transform: scale(1.02); }
        }

        .bank-box {
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(0,242,255,0.08) 100%);
            border: 1px solid rgba(0, 242, 255, 0.4);
            border-radius: 30px; padding: 30px; margin-bottom: 40px;
        }

        .match-card {
            background: var(--card-bg);
            border-radius: 35px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 35px; padding: 30px;
            transition: var(--transition-slow);
            backdrop-filter: blur(15px);
        }

        /* VLAJKY */
        .flags-wrapper { display: flex; justify-content: center; align-items: center; gap: 25px; margin: 25px 0; }
        .flag-img {
            width: 110px; border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            animation: flagWave 3s ease-in-out infinite;
        }
        @keyframes flagWave {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(35deg) scale(1.05); }
        }

        /* FORMUL√Å≈ò */
        .details { display: none; padding-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); margin-top: 30px; text-align: left; }
        .score-row { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 20px 0; }
        .score-input {
            width: 80px; height: 70px; text-align: center;
            font-size: 2em; font-weight: 900;
            background: #000; border: 2px solid #334; color: white; border-radius: 15px;
        }
        .input-field {
            width: 100%; padding: 18px; background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1); color: white;
            border-radius: 20px; box-sizing: border-box; outline: none;
        }
        .btn-add-ticket {
            width: 100%; background: var(--neon); color: var(--dark);
            border: none; padding: 20px; border-radius: 20px;
            font-weight: 900; cursor: pointer; text-transform: uppercase;
        }

        /* KO≈†√çK */
        .fab-cart {
            position: fixed; bottom: 30px; right: 30px;
            width: 75px; height: 75px; background: var(--neon);
            color: var(--dark); border-radius: 50%;
            display: none; align-items: center; justify-content: center;
            font-size: 2em; z-index: 5000; box-shadow: 0 10px 30px rgba(0,242,255,0.4);
        }
        .badge {
            position: absolute; top: -5px; right: -5px;
            background: red; color: white; width: 25px; height: 25px;
            border-radius: 50%; font-size: 0.5em; display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <a href="admin.html" style="position:fixed; top:20px; right:20px; font-size:1.5em; text-decoration:none;">‚öôÔ∏è</a>
    <a href="statistiky.html" style="position:fixed; top:20px; left:20px; font-size:1.5em; text-decoration:none;">üìä</a>

    <img src="IMG_8429.png" class="header-logo" alt="LOGO">

    <div class="bank-box">
        <span style="opacity:0.5; font-size:0.7em; letter-spacing:2px;">CELKOV√ù BANK</span>
        <div style="font-size:3em; font-weight:900;"><span id="uiMainBank">0</span> Kƒç</div>
        <div id="userWelcome" style="margin-top:10px; font-size:0.9em; color:var(--neon); font-weight:bold;"></div>
    </div>

    <div id="matchList">Naƒç√≠t√°m z√°pasy...</div>

    <div id="fabCart" class="fab-cart">
        üéüÔ∏è <div id="fabBadge" class="badge">0</div>
    </div>

    <script type="module">
        import { AuthService } from './js/auth.js';
        import { DBService } from './js/database.js';

        // Registrace Service Workeru pro PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }

        let cart = {};

        // 1. KONTROLA U≈ΩIVATELE
        let user = AuthService.getUser();
        if (!user) {
            const name = prompt("V√≠tej v nov√© s√°zkovce! Zadej sv√© jm√©no:");
            if (name) {
                user = AuthService.setUser(name);
            }
        }
        if (user) {
            document.getElementById('userWelcome').innerText = `Hr√°ƒç: ${user.name} (ID: ${user.id})`;
        }

        // 2. NAƒåTEN√ç DAT
        DBService.getBank(val => document.getElementById('uiMainBank').innerText = val);
        
        DBService.getMatches(zapasy => {
            const container = document.getElementById('matchList');
            container.innerHTML = "";
            if (!zapasy) return;

            Object.entries(zapasy).forEach(([id, m]) => {
                if (m.status === "vyhodnoceno") return; // Skryjeme hotov√© z√°pasy

                const card = document.createElement('div');
                card.className = "match-card";
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; font-size:0.8em; opacity:0.6;">
                        <span>‚è±Ô∏è ${m.deadline.replace('T', ' ')}</span>
                    </div>
                    <div class="flags-wrapper">
                        <div><img class="flag-img" src="https://flagcdn.com/w160/${m.kodD}.png"><br><b>${m.domaci}</b></div>
                        <div style="font-size:1.5em; font-weight:900; color:var(--neon);">VS</div>
                        <div><img class="flag-img" src="https://flagcdn.com/w160/${m.kodH}.png"><br><b>${m.hoste}</b></div>
                    </div>
                    <button class="btn-add-ticket" onclick="document.getElementById('detail-${id}').style.display='block'">VSADIT NA Z√ÅPAS</button>
                    
                    <div id="detail-${id}" class="details">
                        <div class="score-row">
                            <input type="number" id="scD-${id}" class="score-input" placeholder="0">
                            <span style="font-size:2em; color:var(--neon);">:</span>
                            <input type="number" id="scH-${id}" class="score-input" placeholder="0">
                        </div>
                        <input type="text" id="striker-${id}" class="input-field" placeholder="Kdo d√° g√≥l? (p≈ô√≠jmen√≠)">
                        <button class="btn-add-ticket" style="background:white; margin-top:15px;" id="add-${id}">P≈òIDAT DO KO≈†√çKU</button>
                    </div>
                `;
                container.appendChild(card);

                document.getElementById(`add-${id}`).onclick = () => {
                    const sD = document.getElementById(`scD-${id}`).value;
                    const sH = document.getElementById(`scH-${id}`).value;
                    const str = document.getElementById(`striker-${id}`).value;
                    
                    if(sD === "" || sH === "" || !str) return alert("Dopl≈à s√°zku!");

                    cart[id] = { skore: `${sD}:${sH}`, strelec: str, skryt: false };
                    updateFAB();
                    document.getElementById(`detail-${id}`).style.display = 'none';
                };
            });
        });

        function updateFAB() {
            const count = Object.keys(cart).length;
            const fab = document.getElementById('fabCart');
            if(count > 0) {
                fab.style.display = 'flex';
                document.getElementById('fabBadge').innerText = count;
            }
        }

        document.getElementById('fabCart').onclick = async () => {
            const count = Object.keys(cart).length;
            if (confirm(`Odeslat tiket (${count * 20} Kƒç)?`)) {
                try {
                    await DBService.sendTicket(cart);
                    alert("Tiket √∫spƒõ≈°nƒõ odesl√°n pod tv√Ωm ID!");
                    cart = {};
                    location.reload();
                } catch (e) {
                    alert("Chyba p≈ôi odes√≠l√°n√≠: " + e.message);
                }
            }
        };
    </script>
</body>
</html>
