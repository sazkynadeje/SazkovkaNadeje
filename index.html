<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KANCEL√Å≈ò NADƒöJE v2.0</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="IMG_8429.png">

    <style>
        :root { --neon: #00f2ff; --dark: #0f172a; }
        body { background-color: var(--dark); color: #fff; font-family: sans-serif; text-align: center; margin: 0; padding: 15px; }
        .header-logo { max-width: 400px; width: 80%; margin: 20px 0; filter: drop-shadow(0 0 10px var(--neon)); }
        .bank-box { border: 1px solid var(--neon); border-radius: 25px; padding: 25px; margin-bottom: 20px; box-shadow: 0 0 15px rgba(0,242,255,0.2); }
        #enableNotifications { display: none; margin-bottom: 20px; padding: 18px; background: transparent; border: 2px solid var(--neon); color: var(--neon); border-radius: 100px; font-weight: bold; width: 100%; max-width: 300px; cursor: pointer; }
        #notifModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center; }
        .modal-content { background: #1e293b; padding: 30px; border-radius: 30px; border: 2px solid var(--neon); max-width: 280px; }
        .modal-btn { width: 100%; padding: 15px; margin-top: 10px; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; }
        .btn-ano { background: var(--neon); color: #000; }
        #matchList { margin-top: 20px; }
    </style>
</head>
<body>

    <script>
    (function(w,d, s, id) {
        if(typeof(w.webpushr)!=='undefined') return;
        w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};
        var js, fjs = d.getElementsByTagName(s)[0];
        js = d.createElement(s); js.id = id;js.async=1;
        js.src = "https://cdn.webpushr.com/app.min.js";
        fjs.parentNode.appendChild(js);
    }(window,document, 'script', 'webpushr-jssdk-alternative'));

    webpushr('init','BJLqlsfhPhmUGRT1vU8Ob_iUP0ZGtgh2-jGjhFTc8u_rCYpSIBMjasZ1HPA0EJSUDjRfpB59-lv7i1B3zObvF5w','webpushr-sw.js','/SazkovkaNadeje/');
    webpushr('setup', { 'in_app_notification': false, 'onsite_messaging': false });
    </script>

    <img src="IMG_8429.png" class="header-logo">

    <div class="bank-box">
        <div style="font-size: 2.5em; font-weight: 900;"><span id="uiMainBank">0</span> Kƒç</div>
    </div>

    <button id="enableNotifications">üîî ZAPNOUT OZN√ÅMEN√ç</button>

    <div id="matchList">Naƒç√≠t√°m z√°pasy...</div>

    <div id="notifModal">
        <div class="modal-content">
            <h2 style="color:var(--neon)">NOTIFIKACE</h2>
            <p>Chce≈° dost√°vat upozornƒõn√≠ na v√Ωsledky p≈ô√≠mo na displej?</p>
            <button id="btnNotifYes" class="modal-btn btn-ano">ANO, CHCI</button>
        </div>
    </div>

    <script>
        const btnNeon = document.getElementById('enableNotifications');
        const modal = document.getElementById('notifModal');
        const btnYes = document.getElementById('btnNotifYes');

        // Funkce, kter√° vyvol√° to okno (stejn√° jako v testu)
        async function spustitOdber() {
            console.log("Kliknuto na odbƒõr");
            if ('serviceWorker' in navigator) {
                await navigator.serviceWorker.register('webpushr-sw.js');
            }
            webpushr('fetch_subscription', function(result) {
                if(result.status === 'success') {
                    localStorage.setItem('notif_ok', '1');
                    modal.style.display = 'none';
                    btnNeon.style.display = 'none';
                    alert("√öSPƒöCH! ‚úÖ");
                } else {
                    alert("Chyba: " + result.description);
                }
            });
        }

        // Eventy pro tlaƒç√≠tka (vƒçetnƒõ touchend pro iPhone)
        btnYes.onclick = spustitOdber;
        btnYes.addEventListener('touchend', spustitOdber);
        btnNeon.onclick = spustitOdber;
        btnNeon.addEventListener('touchend', spustitOdber);

        // Kontrola stavu po 2 vte≈ôin√°ch
        setTimeout(() => {
            const hotovo = localStorage.getItem('notif_ok');
            if(!hotovo) modal.style.display = 'flex';
            
            webpushr('notification_status', function(status) {
                if(status !== 'granted') btnNeon.style.display = 'inline-block';
            });
        }, 2000);
    </script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script type="module">
        import { DBService } from './js/database.js';
        DBService.getBank(val => document.getElementById('uiMainBank').innerText = val);
        // Tady si pak dopl≈à zbytek sv√© logiky z√°pas≈Ø...
    </script>

</body>
</html>
